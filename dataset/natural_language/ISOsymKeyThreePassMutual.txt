The mutual entity-authentication mechanism is three-pass protocol using a shared symmetric key. It follows the ISO/IEC 9798-2 class where freshness comes from time-variant parameters (nonces) and authenticity is obtained by encrypting structured tuples under the pre-shared key. The run begins with a lightweight challenge from the verifier: a role/tag identifier and a fresh nonce NB. This provides domain separation for the first flight and guarantees replay resistance per the standard’s requirement for time-variant parameters.  ￼

The claimant answers with its own fresh nonce NA and returns a ciphertext produced under the shared key over a tuple that binds direction and peer: (tagITMS3, NA, NB, B, Text2). On receipt, the verifier decrypts and checks the structured fields; success authenticates the claimant, proves aliveness (via NA/NB), and delivers data-origin authentication for Text2 to the verifier. Including the verifier identifier B in the protected data prevents simple reflection/UKS-style misbinding.  ￼

To complete mutual authentication, the verifier sends a third flight: a ciphertext under the same key over (tagITMS2, NB, NA, Text4). The opposite nonce ordering proves the verifier’s possession of the key in this run, and upon decryption the claimant obtains data-origin authentication for Text4. With modern instantiation, the senc primitive SHOULD be authenticated encryption (AEAD) so that integrity of the protected fields is guaranteed (the 2019 edition of 9798-2 explicitly specifies mechanisms “using authenticated encryption”). Note that this construction does not establish a fresh session key; it authenticates using the existing pre-shared key. If key establishment or forward secrecy is required, compose with a KDF over an AKE (e.g., ephemeral DH).  ￼

Reference
	•	ISO/IEC 9798-2 — IT Security techniques — Entity authentication — Part 2. The standard mandates time-variant parameters and defines one-, two-, and three-pass symmetric-key mechanisms for unilateral and mutual authentication; see §5.2.2 for the three-pass mutual variant. (2008/2019 editions and previews).  ￼
	•	Basin, Cremers, Meier, “Provably Repairing the ISO/IEC 9798 Standard for Entity Authentication,” POST 2012 / JCS 2013 — formal analysis and hardening guidelines (e.g., explicit tags, identity binding).  ￼