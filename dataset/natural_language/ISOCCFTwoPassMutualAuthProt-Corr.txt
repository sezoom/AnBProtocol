This is a two-pass, mutual entity-authentication mechanism from the ISO/IEC 9798 family that relies on a shared symmetric key and a cryptographic check function (a MAC). Each side proves possession of the pre-shared key in one message, using a fresh time-variant parameter to ensure timeliness. The “CORRECTED” form you’ve modeled adds explicit, role-specific tags (tagISOTMCCF1, tagISOTMCCF2) and an extra domain-separation value (tag) so that the MAC inputs differ per direction and per deployment context—standard hardening against reflection and cross-protocol misuse. In ISO/IEC 9798-4 terms, this corresponds to the two-pass mutual CCF mechanism (commonly labeled 9798-4-3).  ￼

A run begins when the side initiating the exchange samples a fresh challenge NA and computes a MAC over a structured tuple that binds the direction, the intended peer, and the application data it wishes to authenticate. Concretely, it computes f(tagISOTMCCF1, sk(A,B), NA, B, Text1, tag) and sends this MAC alongside NA, the peer identifier B, and Text1 in the clear. Upon receipt, the peer recomputes the MAC under the shared key and accepts if verification succeeds. This gives the peer assurance that the sender currently knows the key and that Text1 originates from this run; including the peer’s identifier and the role-specific tag in the MAC input fixes the message direction and context.  ￼

The peer then generates its own fresh challenge NB, computes f(tagISOTMCCF2, sk(A,B), NB, A, Text3), and returns the MAC with NB, the initiator’s identifier A, and Text3. Verification by the initiator provides the symmetric guarantee in the opposite direction. Because each direction uses different MAC domains (tagISOTMCCF1 vs tagISOTMCCF2) and binds the peer identity, a simple reflection (feeding a message back to its sender) is prevented; the use of fresh nonces satisfies ISO’s requirement for time-variant parameters and replay resistance in MAC-based authentication. Note that—in line with the ISO design—each direction’s freshness is proved independently (there is no cross-binding of NA and NB in two passes).  ￼

Security properties match the goals you stated: data-origin authentication for Text1 to the responder and for Text3 to the initiator, with mutual entity authentication and freshness. The mechanism by itself does not provide confidentiality for Text1/Text3, does not establish a session key, and does not offer forward secrecy; combine it with key establishment or channel protection if those are required. Robust instantiations use modern MACs (e.g., HMAC/CMAC) and explicit protocol identifiers as standardized; subsequent corrigenda and the formal literature emphasize exactly these hardening measures.  ￼

Reference:
ISO/IEC 9798-4:1999, Information technology — Security techniques — Entity authentication — Part 4: Mechanisms using a cryptographic check function (two-pass mutual mechanism; MAC-based schemes require time-variant parameters).  ￼

ISO/IEC 9798-4:1999/Cor. 2:2012, Technical Corrigendum 2 (defines identifiers/OIDs and clarifies mechanism identifiers and domain separation).  ￼

Basin, Cremers, Meier, “Provably Repairing the ISO/IEC 9798 Standard for Entity Authentication,” POST 2012 (taxonomy listing 9798-4-3 and recommended repairs such as role-specific constants and binding peer identities).  ￼