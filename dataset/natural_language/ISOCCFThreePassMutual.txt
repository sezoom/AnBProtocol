Protocol ISO_threepass_mutual_CCF specifies a three-pass mutual authentication mechanism between two parties A (claimant/respondent) and B (initiator/verifier), based on a pre-shared symmetric key skAB and a MAC function mac. Both A and B know skAB, and no new keys are established by the protocol; its purpose is to provide data-origin authentication in both directions and demonstrate aliveness of each party within a single run. The protocol uses two nonces NB and NA as freshness challenges and allows each side to authenticate an application-specific field (Text2 from A and Text4 from B). All MACs are computed under skAB over structured tuples that include the nonces and associated data, and the cleartext fields are echoed so the receiver can recompute and verify the MAC.

The protocol begins when B initiates the exchange with message m1, sending a tag tagISOTMC1 together with a freshly chosen nonce NB to A: tagISOTMC1 . NB. This identifies the mechanism in use and provides B’s freshness challenge. Upon receiving m1, A chooses its own nonce NA and prepares message m2. In m2, A sends mac{skAB, NA, NB, B, Text2}skAB . NA . NB . B . Text2, i.e., a MAC computed over the tuple (skAB, NA, NB, B, Text2) and then the cleartext components NA, NB, B, and Text2. By including both nonces, the verifier’s identity B, and the application field Text2 in the MAC input, A ensures that the check value is bound to this particular run, to B as the intended partner, and to Text2 as authenticated data. When B receives m2, it recomputes the MAC using skAB and the received NA, NB, B, and Text2. If the values match, B accepts that A currently knows skAB, is responding freshly to the challenge NB, and has sent Text2 as part of this run; thus B obtains one-pass data-origin authentication on Text2 from A.

To provide reciprocal authentication, B then sends message m3: mac{skAB, NB, NA, Text4}skAB . NB . NA . Text4. Here B uses both nonces (NB, NA) and its own application field Text4 as MAC input, and echoes NB, NA, and Text4 in the clear. When A receives m3, it recomputes the MAC under skAB and checks that it matches the received value. Successful verification convinces A that B knows skAB, is referring to the same nonce pair (NA, NB) from this run, and that Text4 is authentic and bound to this exchange. The stated goals capture these properties: B ->* A : Text2 expresses that B gains (non-injective) authentication on Text2 as originating from A in some matching run, and A ->* B : Text4 expresses the symmetric property for A with respect to B and Text4. The protocol does not derive any new channel keys; it is purely a mutual entity and data-origin authentication mechanism built on a pre-shared symmetric key and a cryptographic check function.Reference

ISO/IEC 9798-4:1999, Information technology — Security techniques — Entity authentication — Part 4: Mechanisms using a cryptographic check function (and Technical Corrigendum 2 on identifiers and check-value constants)