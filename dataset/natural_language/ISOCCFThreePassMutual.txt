The  mutual entity-authentication protocol from the ISO/IEC 9798 family is three-pass protocol that relies on a shared symmetric key and a cryptographic check function (i.e., a MAC). Its purpose is to let each peer prove knowledge of the pre-shared key in a run that also authenticates one application field from each side. Freshness is achieved with random nonces. The design corresponds to the “three-pass mutual authentication” class in ISO/IEC 9798-4 (CCF-based mechanisms).  ￼

A run starts when the party acting as verifier sends a protocol tag together with a freshly generated challenge NB. The tag serves as domain separation, ensuring that any cryptographic check values computed in this protocol cannot be replayed in a different one. The standard requires such identifiers and time-variant parameters (timestamps, sequence numbers, or nonces) precisely to prevent acceptance of stale data.  ￼

The claimant answers by generating its own fresh challenge NA and returning a MAC computed under the shared key over the tuple (NA, NB, verifier-ID, Text2). The message then carries NA, NB, the verifier’s identifier, and Text2 in clear so the verifier can recompute and verify the MAC. Successful verification convinces the verifier that the claimant currently knows the key and that Text2 originates from this claimant and run. Including the verifier’s identifier and a fixed protocol tag (or OID) in the MAC input binds direction and context, blocking simple reflection or cross-protocol misuse.  ￼

To complete mutual authentication, the verifier replies with a second MAC under the same key, this time over (NB, NA, Text4), and includes NB, NA, and Text4 in clear. Upon verification, the claimant learns that the verifier also possesses the key in this run, and that Text4 is authenticated to the claimant. The opposite ordering of nonces in the two MAC computations (first (NA, NB, …), then (NB, NA, …)) together with the tag/identifier prevents replay of one side’s MAC as the other’s. Both sides thus obtain entity authentication and data-origin authentication for their respective application fields, with replay resistance provided by the fresh nonces.  ￼

This three-pass CCF mechanism provides mutual authentication and integrity protection for the authenticated fields but does not establish a session key, provide confidentiality for Text2/Text4, or offer forward secrecy; if those properties are needed, it should be combined with key establishment and/or encryption. Robust instantiations use modern MACs (e.g., HMAC or CMAC), generate nonces uniformly at random, and include explicit protocol identifiers as required by the standard and its corrigenda. Evaluations of the 9798 family discuss these design choices and common pitfalls such as reflection or cross-protocol interactions.  ￼

Reference

ISO/IEC 9798-4:1999, Information technology — Security techniques — Entity authentication — Part 4: Mechanisms using a cryptographic check function (and Technical Corrigendum 2 on identifiers and check-value constants)