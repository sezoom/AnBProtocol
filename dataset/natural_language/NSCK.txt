
The protocol introduces a trusted service s that provisions a fresh session key KAB for a pair of peers. Each peer shares a long-term secret only with s (sk(A,s) and sk(B,s)), never directly with the other peer. All sealed structures are explicitly tagged to separate message roles and prevent any ambiguity across legs of the run. The primitive senc{·}(·) denotes authenticated encryption; pre(·,·) is a one-way preprocessing function used when confirming challenges inside the established session.

The run begins with a key request from the initiator to the service. The initiator sends [m1] carrying its own and the responder’s identities plus a fresh nonce NA, all under a role tag. This nonce is the request handle the service will echo to bind the response to the exact solicitation and to the intended peer set (A,B).

The service answers in [m2] with a two-part envelope protected end-to-end to the initiator under sk(A,s). Inside the outer ciphertext it (1) echoes NA and the target identity B, and (2) supplies a fresh session key KAB for this pair. Alongside that, the service embeds a ticket for the responder—a second, inner ciphertext under sk(B,s) that binds KAB to the responder’s view together with the initiator’s identity A. Distinct tags identify the service’s response and the responder-ticket substructure.

The initiator then delivers the service’s material to the responder in [m3]. Concretely, it transmits the sealed blob intended for the responder—an authenticated, responder-verifiable statement carrying KAB and A, produced under sk(B,s) and tagged for this leg. Upon receipt, the responder validates that it came from the service using its own long-term key with s, and, if valid, accepts KAB as the working session key associated with peer A.

With KAB in place on both sides, the responder performs liveness and key-holder confirmation in [m4] by sending an authenticated-encryption under KAB that carries a role tag and a fresh responder challenge NB. The initiator answers in [m5] under the same KAB with a corresponding role tag and the preprocessed image pre(tagnsck7, NB). This use of pre binds the responder’s challenge into the session while keeping the confirmation in a canonical, tag-scoped form.

At completion, both parties have a common session key KAB minted by the service, the initiator has demonstrated receipt of the responder’s challenge within the KAB context, and the responder has a bound record of the initiator’s original request through the service’s echo of NA and identities in the issuance step. The tags (tagnsck1…tagnsck7) and explicit identity fields are integral to the design: they delineate message roles, tie envelopes to their consumers, and keep each cryptographic operation scoped to its precise purpose.