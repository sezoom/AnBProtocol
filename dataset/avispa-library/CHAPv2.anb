Protocol CHAPv2:

Declarations:
    h/1;

Types:
    Agent         A, B;
    Number        nA, nB;
    Symmetric_key k(A,B);
    Function      h;

Knowledge:
    A : k(A,B);
    B : k(A,B);

Actions:
    A -> B      : A;
    B -> A (nB) : nB;
    A -> B (nA) : nA, h(k(A,B).nA.nB.A);
    B -> A      : h(k(A,B).nA);

Goals:
    k(A,B) secret between A,B;
    B -> A : nB;
    A -> B : nA;

end
