Protocol Twelve:

Declarations:
    senc/2;
    h/1;

Types:
    Agent A,B,C;
    Number Kf,N1,N2;
    Symmetric_key Ka,Kb;
    Function h;

Knowledge:
    A : A, B, C, Ka;
    B : A, B, C, Kb;
    C : A, B, C, Ka, Kb;

Public:
    A,B,C;

Private:
    Ka,Kb;

Actions:
    [m1] A -> C             : A . B;
    [m2] C -> A (Kf)        : senc{Kf}Ka . senc{Kf}Kb;
    [m3] A -> B             : senc{Kf}Kb;
    [m4] B -> A (N2)        : senc{N2}Kf;
    [m5] A -> B (N1)        : senc{N1}Kf;
    [m6] B -> A             : senc{h(N1)}Kf;

Goals:
    /* The session key Kf should be secret between the participants */
    Kf secret between A,B,C;

    /* The nonces should be secret between A and B */
    N1 secret between A,B;
    N2 secret between A,B;

    /* Mutual authentication on the nonces and session key */
    A -> B : h(N1);
    B -> A : N1;

ChannelKeys:
    K(A,B): Kf;

end