Protocol Twelve:

Declarations:
    senc/2;
    h/1;

Types:
    Agent A,B,C;
    Number N1,N2;
    Symmetric_key Ka,Kb,Kf;
    Function h;
    Mapping k

Knowledge:
    A : A, B, C, Ka, Kb, C;
    B : A, B, C, Ka, Kb, C;
    C : A, B, C, Ka, Kb;

Public:

Private:
    Ka, Kb;

Actions:
    [t1] A -> C          : A . B;
    [t2] C -> A (Kf)     : senc{ Kf }Ka . senc{ Kf }Kb;
    [t3] A -> B          : senc{ Kf }Kb;
    [t4] B -> A (N2)     : senc{ N2 }Kf;
    [t5] A -> B (N1)     : senc{ N1 }Kf;
    [t6] B -> A          : senc{ h(N1) }Kf;

Goals:
    /* Weak auth of C: A and B each accept Kf as issued by C */
    /* Weak auth of B to A on (Kf, N1) */
    B ->* A : Kf . N1;
    /* Secrecy goals */
    N1 secret between A,B;
    N2 secret between A,B;
    Kf secret between A,B,C;

ChannelKeys:
    K(A,B): Kf;

end