Protocol OtwayRees:

Declarations:
    senc/2;

Types:
    Agent A,B,S;
    Number C,R1,R2;
    Symmetric_key K1,K2,KC;
    Mapping k;

Knowledge:
    A : A, B, S, k(A), k(B), k(S), K1, K2, pk(S);
    B : A, B, S, k(A), k(B), k(S), K1, K2, pk(S);
    S : A, B, S, k(A), k(B), k(S), K1, K2, pk(S);

Public:

Private:
    K1, K2, KC;

Actions:
    [or1] A -> B (C,R1) : C . A . B . senc{ R1 . C . A . B }K1;
    [or2] B -> S (R2)   : C . A . B . senc{ R1 . C . A . B }K1 . senc{ R2 . C . A . B }K2;
    [or3] S -> B (KC)   : C . senc{ R1 . KC }K1 . senc{ R2 . KC }K2;
    [or4] B -> A        : C . senc{ R1 . KC }K1;

Goals:
    B -> A : KC;
    KC secret between A,B;

ChannelKeys:
    K(A,B): KC;

end