Protocol PKINIT-DH:

Declarations:
    aenc/2;
    senc/2;
    h/1;
    kdf/1;
    g/0;

Types:
    Agent A,S;
    Number TA, NA, na, ns, req_body, TGT_data;
    Symmetric_key K;
    Function h, kdf;
    Mapping pk, sk;

Knowledge:
    A : A, S, pk(A), sk(A), pk(S);
    S : A, S, pk(S), sk(S), pk(A);

Public:
    A, S, pk(A), pk(S), g();

Private:
    sk(A), sk(S);

Actions:
    [step1] A -> S (TA, NA, na) : req_body, aenc{ TA . NA . h(req_body) . g()^na }sk(A), pk(A);
    [step2] S -> A (ns) : senc{ TGT_data }kdf((g()^na)^ns), aenc{ g()^ns . NA }sk(S), pk(S);

Goals:
    S -> A : NA;
    A -> S : g()^ns;
    kdf((g()^na)^ns) secret between A,S;

ChannelKeys:
    K(A,S): kdf((g()^na)^ns);

end