Protocol ProtocolFour:

Declarations:
    senc/2;
    g/0;
    exp/2;
    mul/2;

Types:
    Agent A,B;
    Number N1,N2,x,y;
    Function g;

Knowledge:
    A : A, B, g();
    B : A, B, g();

Public:
    g();

Private:
    x, y;

Actions:
    [1] A -> B (x, N1) : exp(g(),x) . N1;
    [2] B -> A (y, N2) : exp(g(),y) . senc{ N1 }exp(g(),mul(x,y)) . N2;
    [3] A -> B         : senc{ N2 }exp(g(),mul(x,y));

Goals:
    A -> B : N2;
    B -> A : N1;
    exp(g(),mul(x,y)) secret between A,B;

ChannelKeys:
    K(A,B): exp(g(),mul(x,y));
    K(B,A): exp(g(),mul(x,y));

end