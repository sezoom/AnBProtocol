Protocol TLS-Handshake:

Declarations:
    aenc/2;
    senc/2;
    h/1;
    prf/3;
    kdf/2;

Types:
    Agent A,B,S;
    Number NA,NB,Sid,PMS,params,client,server;
    Function h,prf,kdf;
    Mapping pk,sk;

Knowledge:
    A : A,B,S,pk(S),pk(A),sk(A);
    B : A,B,S,pk(S),pk(B),sk(B);
    S : S,pk(S),sk(S),A,B;

Public:
    pk(A),pk(B),pk(S);

Private:
    sk(A),sk(B),sk(S);

Actions:
    [step1] A -> B (NA,Sid) : A . Sid . NA . params;
    [step2] B -> A (NB)      : Sid . NB . aenc{ B . pk(B) }sk(S);
    [step3] A -> B (PMS)     : Sid . aenc{ A . pk(A) }sk(S) . aenc{ PMS }pk(B) . aenc{ h(NA . NB) }sk(A) . senc{ h(A . B . Sid . NA . NB . PMS) }kdf(prf(PMS,NA,NB),client);
    [step4] B -> A           : Sid . senc{ h(A . B . Sid . NA . NB . PMS) }kdf(prf(PMS,NA,NB),server);

Goals:
    B -> A : NA . NB;
    A -> B : NA . NB;
    PMS secret between A,B;
    prf(PMS,NA,NB) secret between A,B;

ChannelKeys:
    K(A,B): kdf(prf(PMS,NA,NB),client);
    K(B,A): kdf(prf(PMS,NA,NB),server);

end