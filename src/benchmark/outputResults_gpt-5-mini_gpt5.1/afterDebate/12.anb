Protocol Twelve:

Declarations:
    senc/2;
    h/1;

Types:
    Agent A,B,S;
    Number NA,NB;
    Symmetric_key KAS,KBS,Kf;

Knowledge:
    A : A, B, S, KAS;
    B : A, B, S, KBS;
    S : A, B, S, KAS, KBS;

Public:
    A, B, S;

Private:
    KAS, KBS;

Actions:
    [s1] A -> S : A . B;
    [s2] S -> A (Kf) : senc{ A . B . Kf }KAS . senc{ A . B . Kf }KBS;
    [s3] A -> B : senc{ A . B . Kf }KBS;
    [s4] B -> A (NB) : senc{ NB }Kf;
    [s5] A -> B (NA) : senc{ NA }Kf;
    [s6] B -> A : senc{ h(NA) }Kf;

Goals:
    S -> A : Kf;
    S -> B : Kf;
    A ->* B : Kf . NA;
    Kf secret between A,B,S;
    NA secret between A,B;
    NB secret between A,B;

ChannelKeys:
    K(A,B): Kf;
    K(B,A): Kf;

end