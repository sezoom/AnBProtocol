Protocol Nine:

Declarations:
   aenc/2;
   senc/2;

Types:
    Agent A,B,S;
    Number M, KB;
    Mapping pk/1, sk/1;

Knowledge:
    A : A, B, S, pk(A), sk(A), pk(S), pk(B);
    B : A, B, S, pk(B), sk(B), pk(S);
    S : A, B, S, pk(S), sk(S);

Public:
    pk(A), pk(B), pk(S);

Private:
    sk(A), sk(B), sk(S);

Actions:
    [s1] A -> S : aenc{ A . pk(A) }sk(A);
    [s2] B -> S (KB) : aenc{ B . A . KB }pk(S);
    [s3] S -> B : senc{ pk(A) }KB;
    [s4] B -> A : aenc{ M }pk(A);

Goals:
    B ->* S : pk(A);

ChannelKeys:
    K(B,S): KB;

end