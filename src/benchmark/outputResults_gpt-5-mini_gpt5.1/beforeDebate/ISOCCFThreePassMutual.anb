Protocol ISO9798-3pass-CCF:

Declarations:
    mac/2;

Types:
    Agent A,B;
    Number NA,NB,tag9798,Text2,Text4;
    Symmetric_key KAB;

Knowledge:
    A : A, B, KAB;
    B : A, B, KAB;

Public:
    tag9798;

Private:
    KAB;

Actions:
    [s1] B -> A (NB) : tag9798 . NB . B ;
    [s2] A -> B (NA) : NA . NB . B . Text2 . mac{ NA . NB . B . Text2 }KAB ;
    [s3] B -> A     : NB . NA . Text4 . mac{ NB . NA . Text4 }KAB ;

Goals:
    /* Verifier B authenticates claimant A on Text2 (freshness via NB,NA) */
    B -> A : Text2;
    /* Claimant A authenticates verifier B on Text4 (freshness via NA,NB) */
    A -> B : Text4;
    /* Shared key secrecy */
    KAB secret between A,B;

end